version: build-{branch}-#{build}

branches:
  only:
  # - master
  - develop

environment:
  matrix:
    - appveyor_build_worker_image: Visual Studio 2017
      CMAKE_GENERATOR: Visual Studio 15 2017
      CMAKE_ARCH: -A x64
      CMAKE_TOOLSET: -T host=x64

    - appveyor_build_worker_image: Visual Studio 2019
      CMAKE_GENERATOR: Visual Studio 16 2019
      CMAKE_ARCH: -A x64
      CMAKE_TOOLSET: -T host=x64

    - appveyor_build_worker_image: Ubuntu
      CMAKE_GENERATOR: Ninja
      CC: clang
      CXX: clang++
      CMAKE_BUILD_TYPE: -DCMAKE_BUILD_TYPE=Release

#    - appveyor_build_worker_image: Ubuntu
#      CMAKE_GENERATOR: Ninja
#      CC: clang-10
#      CXX: clang++-10
#      CMAKE_BUILD_TYPE: -DCMAKE_BUILD_TYPE=Release

    - appveyor_build_worker_image: Ubuntu
      CMAKE_GENERATOR: Ninja
      CC: gcc
      CXX: g++
      CMAKE_BUILD_TYPE: -DCMAKE_BUILD_TYPE=Release

#    - appveyor_build_worker_image: Ubuntu
#      CMAKE_GENERATOR: Ninja
#      CC: gcc-8
#      CXX: g++-8
#      CMAKE_BUILD_TYPE: -DCMAKE_BUILD_TYPE=Release

build_script:
  - pwsh: |
       New-Item -Path .\build -ItemType Directory
       Set-Location -Path .\build
       cmake .. -DCML_BUILD_TESTING=ON "-G${env:CMAKE_GENERATOR}" ${env:CMAKE_ARCH} ${env:CMAKE_TOOLSET} ${env:CMAKE_BUILD_TYPE}
       cmake --build . --config Release

test_script:
  - pwsh: |
       ctest -V -C Release

# init:
#   - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
 
# on_finish:
#   - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
